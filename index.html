<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Favicon -->
<link rel="icon" type="image/png" href="favicon.png">

<title>Gráficos VK</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body { 
    background-color: #121212; 
    font-family: 'Montserrat', sans-serif;
    font-weight: 300;
    color: #e0e0e0;
  }
  .legend-box { width: 20px; height: 20px; border-radius:4px; border:1px solid #e0e0e0; }
  .viking-btn { transition: all 0.2s; font-weight:500; }
  .viking-btn:hover { transform: scale(1.05); box-shadow: 0 0 12px #b89ded; }
  .color-item { cursor: grab; display:flex; align-items:center; gap:8px; padding:6px 8px; border:1px solid #333; margin-bottom:6px; border-radius:6px; background:#1f1f1f; }
  .color-index { width: 20px; text-align: center; color: #aaa; font-size: 14px; }
  input, select { border-radius:6px; }
</style>
</head>
<body class="p-6">

<div class="max-w-8xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Painel de cores -->
  <div class="bg-gray-900 p-6 rounded-3xl shadow-2xl">
    <h2 class="text-xl font-semibold mb-4 text-white">Ordem das Cores (Arraste para reorganizar)</h2>
    <div id="colorList" class="flex flex-col gap-2">
      <div class="color-item" data-color="#404040"><span class="color-index">1.</span><div style="width:20px;height:20px;background:#404040;"></div><span>#404040</span></div>
      <div class="color-item" data-color="#8A8A8A"><span class="color-index">2.</span><div style="width:20px;height:20px;background:#8A8A8A;"></div><span>#8A8A8A</span></div>
      <div class="color-item" data-color="#BFBFBF"><span class="color-index">3.</span><div style="width:20px;height:20px;background:#BFBFBF;"></div><span>#BFBFBF</span></div>
      <div class="color-item" data-color="#FFFFFF"><span class="color-index">4.</span><div style="width:20px;height:20px;background:#FFFFFF;"></div><span>#FFFFFF</span></div>
      <div class="color-item" data-color="#B89DED"><span class="color-index">5.</span><div style="width:20px;height:20px;background:#B89DED;"></div><span>#B89DED</span></div>
      <div class="color-item" data-color="#5A23C5"><span class="color-index">6.</span><div style="width:20px;height:20px;background:#5A23C5;"></div><span>#5A23C5</span></div>
      <div class="color-item" data-color="#3C696C"><span class="color-index">7.</span><div style="width:20px;height:20px;background:#3C696C;"></div><span>#3C696C</span></div>
      <div class="color-item" data-color="#5A9EA3"><span class="color-index">8.</span><div style="width:20px;height:20px;background:#5A9EA3;"></div><span>#5A9EA3</span></div>
      <div class="color-item" data-color="#90BEC2"><span class="color-index">9.</span><div style="width:20px;height:20px;background:#90BEC2;"></div><span>#90BEC2</span></div>
      <div class="color-item" data-color="#CEE2E4"><span class="color-index">10.</span><div style="width:20px;height:20px;background:#CEE2E4;"></div><span>#CEE2E4</span></div>
    </div>
  </div>

  <!-- Área de gráficos -->
  <div class="bg-gray-900 p-6 rounded-3xl shadow-2xl flex flex-col">
    <h1 class="text-3xl font-semibold mb-6 text-center text-white">Gráficos Interativos</h1>

    <div class="mb-4">
      <label class="block font-semibold mb-1">Valores (separados por ;)</label>
      <input id="valuesInput" type="text" placeholder="Ex: 20;30;15;10" 
             class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-300 bg-gray-800 text-white font-light">
    </div>

    <div class="mb-6">
      <label class="block font-semibold mb-1">Legendas (separadas por ;)</label>
      <input id="labelsInput" type="text" placeholder="Ex: 41-50 anos;51-60 anos;61-70 anos;mais de 71 anos;menos de 40 anos" 
             class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-300 bg-gray-800 text-white font-light">
    </div>

    <div class="flex flex-wrap justify-center gap-4 mb-6">
      <button id="btnPie" class="viking-btn px-5 py-2 bg-purple-800 text-white rounded">Pizza</button>
      <button id="btnBar" class="viking-btn px-5 py-2 bg-purple-700 text-white rounded">Barra</button>
      <button id="btnLegend" class="viking-btn px-5 py-2 bg-gray-700 text-white rounded">Só Legenda</button>
      <button id="btnSave" class="viking-btn px-5 py-2 bg-green-700 text-white rounded">Salvar PNG</button>
    </div>

    <div class="flex flex-col items-center gap-6">
      <canvas id="chartCanvas" class="bg-gray-800 rounded-xl shadow-2xl p-4"></canvas>
      <div id="legendContainer" class="flex flex-wrap gap-4 justify-center"></div>
    </div>
  </div>

  <!-- Tutorial lateral -->
  <div class="bg-gray-900 p-6 rounded-3xl shadow-2xl">
    <h2 class="text-2xl font-semibold mb-4 text-white">Bem-vindo, Viking!</h2>
    <p class="mb-3">Aqui você pode criar gráficos interativos rapidamente:</p>
    <ol class="list-decimal list-inside mb-3 space-y-2">
      <li>Digite os <strong>valores</strong> separados por ponto e vírgula (;).</li>
      <li>Digite as <strong>legendas</strong> correspondentes, também separadas por ponto e vírgula (;).</li>
      <li>Reordene as <strong>cores</strong> arrastando os itens à esquerda.</li>
      <li>Escolha o tipo de gráfico (Pizza, Barra ou Só Legenda).</li>
      <li>Clique em <strong>Salvar PNG</strong> para baixar o gráfico ou clique com o botão direito, copie e cole direto no Canva.</li>
    </ol>
  </div>
</div>

<script>
let colors = Array.from(document.querySelectorAll('#colorList .color-item')).map(item => item.dataset.color);
const chartCanvas = document.getElementById('chartCanvas');
const legendContainer = document.getElementById('legendContainer');
let chartInstance = null;

function parseInput(input) {
  return input.split(';').map(x => x.trim()).filter(x => x !== '');
}

function getCurrentColors() {
  colors = Array.from(document.querySelectorAll('#colorList .color-item')).map(item => item.dataset.color);
  return colors;
}

function createLegend(labels, centralizado = false) {
  legendContainer.innerHTML = '';
  const cores = getCurrentColors();
  
  if (centralizado) {
    // Centralizado na tela
    legendContainer.style.display = 'flex';
    legendContainer.style.flexDirection = 'column';
    legendContainer.style.alignItems = 'center';
    legendContainer.style.justifyContent = 'center';
    legendContainer.style.height = '70vh';
    legendContainer.style.gap = '16px';

    // Criar duas linhas de até 5 itens
    const primeiraLinha = document.createElement('div');
    const segundaLinha = document.createElement('div');
    primeiraLinha.style.display = 'flex';
    primeiraLinha.style.gap = '40px';
    primeiraLinha.style.justifyContent = 'center';
    segundaLinha.style.display = 'flex';
    segundaLinha.style.gap = '40px';
    segundaLinha.style.justifyContent = 'center';

    labels.forEach((label, i) => {
      const item = document.createElement('div');
      item.style.display = 'flex';
      item.style.alignItems = 'center';
      item.style.gap = '10px';
      item.style.fontSize = '18px';
      item.style.fontStyle = 'italic';
      item.style.fontWeight = '600';
      item.style.color = '#e0e0e0';

      // Número da cor
      const num = document.createElement('span');
      num.textContent = `${i + 1}.`;
      num.style.color = '#aaa';
      num.style.width = '22px';
      num.style.textAlign = 'right';
      item.appendChild(num);

      // Quadrado colorido
      const box = document.createElement('div');
      box.className = 'legend-box';
      box.style.backgroundColor = cores[i] || '#ccc';
      item.appendChild(box);

      // Texto
      const text = document.createElement('span');
      text.textContent = label;
      item.appendChild(text);

      if (i < 5) primeiraLinha.appendChild(item);
      else segundaLinha.appendChild(item);
    });

    legendContainer.appendChild(primeiraLinha);
    if (labels.length > 5) legendContainer.appendChild(segundaLinha);
    chartCanvas.width = chartCanvas.height = 0; // esconde canvas
  } else {
    // Modo normal (Pizza/Barra)
    legendContainer.style.display = 'flex';
    legendContainer.style.flexWrap = 'wrap';
    legendContainer.style.justifyContent = 'center';
    legendContainer.style.alignItems = 'center';
    legendContainer.style.gap = '10px';
    legendContainer.style.height = 'auto';

    labels.forEach((label, i) => {
      const item = document.createElement('div');
      item.style.display = 'flex';
      item.style.alignItems = 'center';
      item.style.gap = '6px';
      item.style.fontSize = '15px';
      item.style.color = '#e0e0e0';

      const num = document.createElement('span');
      num.textContent = `${i + 1}.`;
      num.style.color = '#aaa';
      num.style.width = '20px';
      num.style.textAlign = 'right';
      item.appendChild(num);

      const box = document.createElement('div');
      box.className = 'legend-box';
      box.style.backgroundColor = cores[i] || '#ccc';
      item.appendChild(box);

      const text = document.createElement('span');
      text.textContent = label;
      item.appendChild(text);

      legendContainer.appendChild(item);
    });
  }
}

function drawPie(valuesInput, labelsInput) {
  const values = parseInput(valuesInput).map(Number);
  const labels = parseInput(labelsInput);
  if (values.length !== labels.length) { alert('Erro: número de valores e legendas deve ser igual!'); return; }
  createLegend(labels);
  chartCanvas.width = 500; chartCanvas.height = 500;
  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(chartCanvas, {
    type: 'pie',
    data: {
      labels,
      datasets: [{
        data: values,
        backgroundColor: getCurrentColors().slice(0, values.length),
        borderColor: '#121212',
        borderWidth: 2
      }]
    },
    options: {
      responsive: false,
      plugins: {
        legend: { display: false },
        tooltip: { enabled: true },
        datalabels: {
          color: ctx => {
            const bg = getCurrentColors()[ctx.dataIndex];
            return bg.toUpperCase() === '#FFFFFF' ? '#BFBFBF' : '#FFFFFF';
          },
          font: { family: 'Montserrat', weight: '400', size: 26 },
          formatter: (value, ctx) => {
            const total = ctx.chart.data.datasets[0].data.reduce((a,b)=>a+b,0);
            const percent = (value / total) * 100;
            return percent < 1 ? '' : Math.round(percent) + '%';
          },
          anchor: 'center',
          align: 'center'
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}

function drawBar(valuesInput, labelsInput) {
  const values = parseInput(valuesInput).map(Number);
  const labels = parseInput(labelsInput);
  if (values.length !== labels.length) { alert('Erro: número de valores e legendas deve ser igual!'); return; }
  createLegend(labels);
  chartCanvas.width = 700; chartCanvas.height = 400;
  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(chartCanvas, {
    type: 'bar',
    data: { 
      labels, 
      datasets: [{
        data: values, 
        backgroundColor: getCurrentColors().slice(0, values.length),
        borderColor: '#121212',
        borderWidth: 2
      }] 
    },
    options: { 
      responsive: false,
      plugins: { 
  legend: { display: false }, 
  tooltip: { enabled: true }, 
  datalabels: { 
    anchor: 'end',
    align: 'end',
    color: ctx => {
      const bg = getCurrentColors()[ctx.dataIndex];
      return bg.toUpperCase() === '#FFFFFF' ? '#404040' : '#FFFFFF';
    },
    font: {
      family: 'Montserrat',
      size: 18,
      weight: '600'
    },
    formatter: (value) => value
  }
},
      scales: { x: { display: false }, y: { display: false } }
    },
    plugins: [ChartDataLabels]
  });
}

function drawOnlyLegend(labelsInput) {
  const labels = parseInput(labelsInput);
  if (chartInstance) chartInstance.destroy();
  createLegend(labels, true);
}

document.getElementById('btnPie').addEventListener('click', () => drawPie(document.getElementById('valuesInput').value, document.getElementById('labelsInput').value));
document.getElementById('btnBar').addEventListener('click', () => drawBar(document.getElementById('valuesInput').value, document.getElementById('labelsInput').value));
document.getElementById('btnLegend').addEventListener('click', () => drawOnlyLegend(document.getElementById('labelsInput').value));
document.getElementById('btnSave').addEventListener('click', () => {
  if (!chartInstance) { alert('Nenhum gráfico para salvar!'); return; }
  const link = document.createElement('a');
  link.href = chartCanvas.toDataURL('image/png');
  link.download = 'grafico.png';
  link.click();
});

new Sortable(document.getElementById('colorList'), { animation: 150, onEnd: evt => getCurrentColors() });
</script>

</body>
</html>